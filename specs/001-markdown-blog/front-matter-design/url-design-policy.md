# URL設計ポリシー

## 概要

本ドキュメントは、個人ブログにおけるURL設計の基本方針と原則を定義する。URL構造の決定において、技術的実装よりも優先すべき設計思想を明確にすることを目的とする。

## URL構造

```
blog/[id]/[slug]
```

## 設計目的

### 1. リソースの永続性と信頼性

個人ブログ規模においても、一度公開された記事のURLは**永続的な識別子**として機能すべきである。読者がブックマークしたURL、外部からのリンク、検索エンジンのインデックスなど、URLは記事への「約束」として扱う。

### 2. 人間にとっての可読性

URLは機械だけでなく、人間が読んで意味を理解できるべきである。URLを見ただけで記事の内容や公開時期をある程度推測できることは、ユーザー体験の向上に寄与する。

### 3. 段階的な執筆フロー

draft（下書き）から公開への移行をスムーズにするため、執筆の初期段階では細部（slug）を確定させる必要がない柔軟性を持たせる。

### 4. 将来への拡張性

現在はローカルSQLiteでの運用を想定するが、将来的に他のストレージシステムへの移行や、複数ブログの統合などを考慮した設計とする。

## IDの役割と制約

### 役割

- **唯一性の保証**: すべての記事に対して一意の識別子を提供
- **技術的な安定性**: データベースの主キーとして機能し、内部的な記事管理の基盤となる
- **リダイレクトの起点**: slugが変更されても、IDによって正しい記事を特定できる

### 制約と理由

**公開後は変更不可（immutable）**

これは技術的制約ではなく、**設計上の意図的な制約**である。

- **外部リンクの保護**: 他サイトからのリンクが機能し続けることを保証
- **検索エンジン対応**: インデックスされたURLの一貫性を維持
- **データの一貫性**: IDが変わらないことで、アクセス解析や履歴管理が安定する
- **シンプルな実装**: 変更可能にすると、リダイレクト管理やエラーハンドリングが複雑になる

### 技術要件

- 将来的な他システムへの移行時に、ID体系を維持または変換可能であること
- 衝突の可能性が極めて低いこと

## Slugの役割と制約

### 役割

- **可読性の向上**: URLから記事内容を推測可能にする
- **SEO的な意味づけ**: 検索エンジンに対して記事の内容を示唆する
- **日付情報の提供**: 記事の公開時期を明示する

### 制約と理由

**フォーマット: `日付-内容説明`**

- 日付により、時系列での整理が容易になる
- ハイフン区切りにより、単語の区切りが明確になる
- 英語での記述により、URL互換性の問題を回避

**Draft時は省略可能**

執筆の初期段階では、記事の方向性が定まっていないことが多い。この段階でslugを強制すると、以下の問題が生じる：

- 執筆の流れが中断される
- 暫定的なslugを後で変更する手間が発生する
- 内容が固まる前にslugを決めることで、記事の方向性が制限される可能性

**公開時は必須**

公開段階では、記事の内容が確定しており、適切なslugを決定できる状態にある。slugなしでの公開を許可しない理由：

- URL設計の一貫性を保つ
- 可読性の低下を防ぐ
- 意図的な設計であることを明示する

**公開後も変更可能（非推奨）**

これは現実的な妥協である。理想的にはslugも変更すべきではないが、以下の理由で変更を許可する：

- 記事の大幅なリライト時に、slugが内容と乖離する場合がある
- タイトルの誤字や不適切な表現を修正したい場合がある
- 完全に禁止すると、運用上の柔軟性が失われる

ただし、IDが不変であるため、旧slugでのアクセスもIDを通じて新slugにリダイレクト可能である。

## URLアクセスパターン

### IDのみでのアクセス

```
blog/[id]
```

このパターンでもアクセス可能とする。理由：

- Slugが変更された際の混乱を防ぐ
- 簡潔なURL共有が可能
- 内部リンクや自動生成リンクで利用しやすい

### 完全なURLでのアクセス

```
blog/[id]/[slug]
```

これが標準形式であり、公開時にはこの形式を推奨する。

### 誤ったSlugでのアクセス

```
blog/[id]/[wrong-slug]
```

IDが正しければ、正しいslugにリダイレクトする。これにより：

- 古いブックマークが機能し続ける
- Slugの変更による影響を最小化
- ユーザーに混乱を与えない

## 設計の優先順位

本URL設計において、以下の優先順位を設定する：

1. **永続性**: 一度公開されたURLは可能な限り機能し続ける
2. **一意性**: すべての記事が確実に区別できる
3. **可読性**: URLから記事の内容が推測できる
4. **柔軟性**: 執筆フローを妨げない
5. **実装容易性**: 技術的に実現可能で、メンテナンスしやすい

これらが相反する場合、上位の原則を優先する。

## 将来の拡張シナリオ

本設計は、以下のような将来の変更に対応可能である：

- **データベース移行**: SQLiteから他のDBMSへの移行時も、ID体系を維持または変換可能
- **複数ブログの統合**: IDの名前空間を拡張することで対応可能
- **カテゴリ構造の追加**: `blog/[category]/[id]/[slug]`のような拡張が可能
- **多言語対応**: slugに言語コードを含める、または別の言語版を別IDで管理

## まとめ

本URL設計ポリシーは、**技術的な実装詳細ではなく、設計の意図と理由を明確にする**ことを目的とする。具体的な実装（正規表現、SQL、バリデーション）は別のドキュメントで定義されるべきである。

このポリシーに基づいて実装を進めることで、一貫性があり、将来の変更にも耐えうるURL構造を実現できる。

