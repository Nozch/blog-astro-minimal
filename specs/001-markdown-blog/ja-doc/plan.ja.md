# 実装計画: ミニマルMarkdownブログ

**ブランチ**: `001-markdown-blog` | **日付**: 2025-12-14 | **仕様**: [spec.md](./spec.md)
**入力**: `/specs/001-markdown-blog/spec.md` からの機能仕様

**注意**: このテンプレートは `/speckit.plan` コマンドによって埋められます。実行ワークフローについては `.specify/templates/commands/plan.md` を参照してください。

## 概要

Astroの静的サイト生成を使用して、Markdownベースの執筆を公開する、ミニマルでコンテンツ重視の個人ブログを構築します。このシステムは、フロントマターメタデータを持つMarkdownファイルを静的HTMLページにレンダリングし、時系列ナビゲーション、レスポンシブタイポグラフィ、ライト/ダークテーマ、タグベース整理を提供します—すべて長期的な耐久性とプラットフォーム独立性のために最適化されています。

## 技術コンテキスト

**言語/バージョン**: Node.js（最新LTS推奨、最小 Node 18+）
**主要依存関係**: Astro (v4+)、Markdownパーサー（Astroに組み込み）、シンタックスハイライター（ShikiまたはPrism）、CSS（テーマ用カスタムプロパティ）
**ストレージ**: ファイルシステムベース（`src/content/posts/` のMarkdownファイル）
**テスト**: 単体/統合テスト用Vitest、型チェック用TypeScript、リント用ESLint
**ターゲットプラットフォーム**: 静的ホスティング（Netlify、Vercel、GitHub Pages、Cloudflare Pages、または任意の静的ファイルホスト）
**プロジェクトタイプ**: 単一Webプロジェクト（静的サイトジェネレータ出力）
**パフォーマンス目標**: Lighthouse ≥90、First Contentful Paint <1.5s、Time to Interactive <3.5s（3G環境）、100記事でビルド時間 <5分
**制約**: 静的のみの出力（サーバーランタイムなし）、JavaScript最小限（プログレッシブエンハンスメント）、無効なフロントマターでビルドは即座に失敗
**規模/スコープ**: 100以上のブログ記事、320px-4Kレスポンシブ、3Gで <2s ロード、記事追加ごとのビルド時間増加 <5s

## 憲法チェック

_ゲート: フェーズ0リサーチ前に合格必須。フェーズ1設計後に再チェック。_

### I. 静的ファースト・アーキテクチャ ✅

- **準拠**: 完全。AstroはSSGがデフォルト。ブログコンテンツは完全に静的HTML/CSS。テーマトグルのみがクライアントJavaScript（プログレッシブエンハンスメント）。
- **正当化**: ブログにはパーソナライゼーションや動的データ要件がありません。静的生成は耐久性とプラットフォーム独立性の目標と完璧に一致します。

### II. ガードレールとしてのパフォーマンス ✅

- **準拠**: 完全。成功基準（SC-004、SC-008、SC-009）がLighthouse ≥90、3Gで <2s ロード、記事ごとのビルド時間 <5s を強制します。
- **正当化**: パフォーマンスは仕様と憲法により明示的に要求されています。監視はCIで自動化されます。

### III. 高価値での最小限テスト ✅

- **準拠**: 完全。ユーザー入力は「プロジェクトにテストがゼロであってはならない」と要求。計画には高価値統合テスト用のVitestが含まれます（Markdown解析、フロントマターバリデーション、ビルド出力検証）。
- **正当化**: テストは重要なパスに焦点を当てます：ビルドが壊れない、Markdownが正しくレンダリングされる、ドラフトが除外される。純粋なプレゼンテーションコンポーネントのテストはなし。

### IV. コンテンツファースト設計 ✅

- **準拠**: 完全。仕様は、YAMLフロントマターを持つポータブルなMarkdown、セマンティックHTML出力、最適化されたタイポグラフィ、最初からのダークモードを要求します。
- **正当化**: コンテンツポータビリティ（SC-005）と気を散らさない読書（US3）は中核要件です。設計は実装を超えてコンテンツが存続することをサポートします。

### V. 完璧さより開発速度 ✅

- **準拠**: 完全。MVPスコープは検索、コメント、i18n、CMS統合を除外します。計画はP1-P4ユーザーストーリーの段階的出荷を優先します。
- **正当化**: 仕様は非MVP機能を明示的に除外します。単一著者ブログの迅速な反復に焦点を当てます。

### ビルドとデプロイメント基準

#### 高速フィードバックループ ✅

- **準拠**: 完全。Astro HMRはデフォルトで動作します。ビルド時間制約 <5分（SC-008）。ユーザー入力は自動化されたビルドを要求します。
- **正当化**: 仕様は低摩擦公開を要求します（SC-001: <5分で公開）。高速ビルドは実験を可能にします。

#### デプロイメント規律 ✅

- **準拠**: 完全。静的出力により即座のロールバックが可能（以前のビルドの再デプロイ）。CIオートメーションはユーザー入力により必須。
- **正当化**: ソロプロジェクトにはセーフティネットが必要です。静的デプロイは動的バックエンドより本質的に安全です。

### コンテンツとUX基準

#### アクセシビリティベースライン ✅

- **準拠**: 完全。SC-007はWCAG AAコントラストを要求、FR-012は320px-4Kレスポンシブデザインを要求、仕様はセマンティックHTMLを要求（FR-001）。
- **正当化**: アクセシビリティは憲法により交渉不可能で、成功基準で明示的に測定されます。

#### 視覚的一貫性 ✅

- **準拠**: 完全。テーマはCSSカスタムプロパティを使用（憲法要件）。最小限のコンポーネントセット（ヘッダー、フッター、記事リスト、記事ビュー）。
- **正当化**: シンプルなデザインシステムがドリフトを防ぎます。憲法はCSS変数でのデザイントークンを要求します。

### **ゲート結果**: ✅ 合格 - 違反なし。フェーズ0に進む。

---

## 設計後憲法再評価

_フェーズ1設計後に再評価（research.md、data-model.md、contracts、quickstart.md）_

### 設計成果物レビュー

**リサーチ決定** (`research.md`):

- ✅ Shikiシンタックスハイライター: ビルド時のみ、ランタイムJSゼロ（静的ファースト ✅）
- ✅ Zodバリデーション: 無効なフロントマターで即座に失敗（高速フィードバックループ ✅）
- ✅ CSSカスタムプロパティ: 憲法要件を満たす（視覚的一貫性 ✅）
- ✅ システムフォントスタック: Webフォントなし、即座のレンダリング（パフォーマンス ✅）
- ✅ Vitest統合テスト: 高価値テストのみ（最小限テスト ✅）
- ✅ 単一グローバルCSSファイル: 早期抽象化なし（開発速度 ✅）

**データモデル** (`data-model.md`):

- ✅ ファイルベースストレージ: ポータブルなMarkdownファイル（コンテンツファースト ✅）
- ✅ ビルド時バリデーション: Zodスキーマがフロントマタールールを強制（高速フィードバックループ ✅）
- ✅ 静的クエリ: すべてのデータがビルド時に解決（静的ファースト ✅）

**契約** (`contracts/frontmatter-schema.yaml`):

- ✅ 最小限の必須フィールド: `title` と `date` のみ必須（開発速度 ✅）
- ✅ オプション拡張が文書化: 過剰設計なしで将来性確保（開発速度 ✅）

**クイックスタート** (`quickstart.md`):

- ✅ 50分のセットアップ時間: 高速なオンボーディング（開発速度 ✅）
- ✅ CIオートメーション含む: typecheck、lint、test、build（高速フィードバックループ ✅）
- ✅ 全体的にセマンティックHTML: アクセシビリティベースラインを満たす（アクセシビリティベースライン ✅）

### 最終憲法準拠: ✅ 合格

**要約**: すべての設計決定が憲法原則と整合しています。計画中に違反は導入されませんでした。実装を進める準備ができています。

**主要な整合性**:

1. **静的ファースト**: 100%静的出力、最小限のJS（テーマトグルのみ）
2. **パフォーマンス**: システムフォント、ビルド時シンタックスハイライト、CSSカスタムプロパティ
3. **テスト**: 重要なパスの統合テスト、プレゼンテーションコンポーネントの単体テストなし
4. **コンテンツファースト**: ポータブルなMarkdown、セマンティックHTML、レスポンシブタイポグラフィ
5. **速度**: シンプルなアーキテクチャ、早期抽象化なし、高速セットアップ

**例外**: 不要。

## プロジェクト構造

### ドキュメント（この機能）

```text
specs/001-markdown-blog/
├── plan.md              # このファイル（/speckit.planコマンド出力）
├── research.md          # フェーズ0出力（/speckit.planコマンド）
├── data-model.md        # フェーズ1出力（/speckit.planコマンド）
├── quickstart.md        # フェーズ1出力（/speckit.planコマンド）
├── contracts/           # フェーズ1出力（/speckit.planコマンド）
│   └── frontmatter-schema.yaml
└── tasks.md             # フェーズ2出力（/speckit.tasksコマンド - /speckit.planでは作成されない）
```

### ソースコード（リポジトリルート）

```text
# Astroプロジェクト構造（作成予定）
astro-blog/
├── src/
│   ├── content/
│   │   ├── config.ts           # コンテンツコレクションスキーマ（Astroの組み込みバリデーション）
│   │   └── posts/              # Markdownブログ記事（ユーザーコンテンツ）
│   │       └── example-post.md
│   ├── layouts/
│   │   └── BaseLayout.astro    # 共有レイアウト（HTML構造、head、テーマスクリプト）
│   ├── pages/
│   │   ├── index.astro         # ホームページ（記事リスト）
│   │   ├── posts/
│   │   │   └── [slug].astro    # 個別記事ページ
│   │   └── tags/
│   │       └── [tag].astro     # タグフィルター済み記事リスト
│   ├── components/
│   │   ├── Header.astro        # ナビ付きサイトヘッダー
│   │   ├── Footer.astro        # サイトフッター
│   │   ├── ThemeToggle.astro   # ライト/ダークモードトグル（唯一のクライアントJS）
│   │   ├── PostList.astro      # 記事リストコンポーネント
│   │   └── PostMeta.astro      # 記事メタデータ表示
│   └── styles/
│       └── global.css          # CSSカスタムプロパティ、タイポグラフィ、ベーススタイル
├── public/                     # 静的アセット（favicon、画像）
├── tests/
│   ├── content.test.ts         # フロントマターバリデーション、Markdown解析
│   ├── build.test.ts           # ビルド出力検証
│   └── integration/            # 統合テスト（必要に応じて）
├── astro.config.mjs            # Astro設定
├── tsconfig.json               # TypeScript設定
├── package.json                # 依存関係、スクリプト
├── vitest.config.ts            # Vitestテスト設定
└── .github/
    └── workflows/
        └── ci.yml              # CI: typecheck、lint、build、test
```

**構造決定**: 単一Webプロジェクト構造。Astroは規約を強制します：コンテンツコレクション（スキーマバリデーション付きMarkdown）には `src/content/`、ルート（ファイルベースルーティング）には `src/pages/`、共有レイアウトには `src/layouts/`、再利用可能UIには `src/components/`。これは憲法の静的ファースト・アーキテクチャとAstroの意見の強いSSGアプローチに整合します。

## 複雑性追跡

> **憲法チェックに正当化が必要な違反がある場合のみ記入**

_違反なし。テーブルは意図的に空のままにします。_
