# 機能仕様: ミニマルMarkdownブログ

**機能ブランチ**: `001-markdown-blog`
**作成日**: 2025-12-14
**ステータス**: ドラフト
**入力**: ユーザー記述: "目的（Why）: このプロジェクトの目的は、Markdownベースの執筆を、読みやすく、耐久性があり、長期的に保守可能な形で公開する個人ブログを構築することです。プロジェクトは以下を優先します：プラットフォーム独立性、執筆から公開までの低摩擦、コンテンツファーストアプローチ、静かな読書体験、安全な進化の能力。"

## ユーザーシナリオとテスト _(必須)_

### ユーザーストーリー 1 - ブログ記事の執筆と公開 (優先度: P1)

ライターとして、ローカルエディタでMarkdownを書いて新しいブログ記事を作成し、指定されたフォルダに保存すると、適切なフォーマットで公開されたブログに自動的に表示されるようにしたい。これにより、公開の仕組みを気にせず執筆に集中できます。

**この優先度の理由**: これはブログの中核的な価値提案です。コンテンツを簡単に執筆して公開する能力がなければ、プロジェクト全体に目的がありません。これが最初に機能する必要があります。

**独立テスト**: 標準フォーマット（見出し、段落、リスト、コードブロック）を含むMarkdownファイルを作成し、コンテンツディレクトリに配置し、ビルドをトリガーして、正しいレンダリングでライブサイトに表示されることを確認することで、完全にテストできます。

**受け入れシナリオ**:

1. **前提** フロントマター（title、date、オプションでdescription）を持つMarkdownファイルがある、**条件** コンテンツディレクトリに配置してサイトをビルドする、**結果** 記事が正しいメタデータでブログインデックスに表示される
2. **前提** 記事に標準Markdown要素（見出し、段落、太字、斜体、リンク、リスト、コードブロック、引用）が含まれる、**条件** 記事がレンダリングされる、**結果** すべての要素が適切なセマンティックHTMLと読みやすいスタイリングで表示される
3. **前提** 既存の記事のコンテンツを更新する、**条件** サイトを再ビルドする、**結果** 他の記事を壊すことなく変更が反映される
4. **前提** フロントマターにドラフトステータスフラグを持つ記事を書く、**条件** サイトがビルドされる、**結果** ドラフト記事は公開ブログに表示されない

---

### ユーザーストーリー 2 - ブログ記事の閲覧とナビゲート (優先度: P2)

読者として、ホームページで時系列のブログ記事リストを表示し、明確なタイトルと日付で個別の記事にナビゲートできるようにしたい。これにより、コンテンツを簡単に発見して読むことができます。

**この優先度の理由**: コンテンツが公開できるようになったら、読者がそれを発見する方法が必要です。ナビゲーションがなければ、ブログは読書体験として機能しません。

**独立テスト**: 異なる日付で複数の記事を公開し、ホームページを訪問して、記事が逆時系列順（新しい順）で読みやすいタイトル、日付、動作するリンクと共にリストされていることを確認することでテストできます。

**受け入れシナリオ**:

1. **前提** 複数の公開された記事がある、**条件** ホームページを訪問する、**結果** 記事が逆時系列順（新しい順）でリストされている
2. **前提** ブログインデックスを表示している、**条件** 記事タイトルをクリックする、**結果** 完全なコンテンツを含む記事ページ全体にナビゲートする
3. **前提** 記事を読んでいる、**条件** インデックスに戻りたい、**結果** ホームページへの明確なナビゲーションリンクをクリックできる
4. **前提** 記事のフロントマターに説明がある、**条件** インデックスを表示する、**結果** 説明がプレビュースニペットとして表示される

---

### ユーザーストーリー 3 - 気が散らない環境での記事閲覧 (優先度: P3)

読者として、優れたタイポグラフィ、適切な行長、適切なコントラスト、ライト/ダークモードのサポートを備えた、クリーンで読みやすいレイアウトでブログ記事を読みたい。これにより、視覚的な気を散らす要素なくコンテンツに集中できます。

**この優先度の理由**: 公開とナビゲーションが機能した後、読書体験がエンゲージメントに重要になります。これによりブログが機能的なものから使いやすいものに変わります。

**独立テスト**: 異なるデバイスと画面サイズで記事を開き、タイポグラフィ（フォントサイズ、行の高さ、行長）をチェックし、ダークモードトグルが機能することを確認し、気を散らすUI要素が読書を妨げないことを確認することでテストできます。

**受け入れシナリオ**:

1. **前提** デスクトップで記事を読んでいる、**条件** コンテンツエリアを表示する、**結果** テキストは最適な行長（50-75文字）、快適なフォントサイズ（18-20px）、ゆとりのある行の高さ（1.6-1.8）を持つ
2. **前提** ダークモードを好む、**条件** テーマ設定をトグルする、**結果** サイトが適切なコントラストでダークモードに切り替わり、訪問間で設定が持続する
3. **前提** モバイルで記事を読んでいる、**条件** 記事を表示する、**結果** コンテンツがレスポンシブで、ズームなしで読みやすく、マージンが適切に適応する
4. **前提** コード重視の記事を読んでいる、**条件** コードブロックを表示する、**結果** コードはシンタックスハイライト、適切な等幅フォント、必要に応じて横スクロール、ライトとダークモードの両方で読みやすいコントラストを持つ

---

### ユーザーストーリー 4 - トピック別の記事整理 (優先度: P4)

ライターとして、フロントマターでタグやカテゴリーで記事を分類し、自動的にグループ化されるようにしたい。これにより、読者が手動リンクなしで関連コンテンツを見つけられます。

**この優先度の理由**: これは複数のトピックを持つブログには価値がありますが、MVPには必須ではありません。ブログはこれなしで機能しますが、整理によりコンテンツが増えるにつれて発見性が向上します。

**独立テスト**: 記事のフロントマターにタグ/カテゴリーフィールドを追加し、サイトをビルドして、フィルタされたビューまたはタグページが自動的に生成されることを確認することでテストできます。

**受け入れシナリオ**:

1. **前提** 記事のフロントマターにタグを追加する、**条件** サイトがビルドされる、**結果** 記事がタグを表示し、各タグがそのタグを持つ記事のフィルタされたビューにリンクする
2. **前提** タグリンクをクリックする、**条件** タグページが読み込まれる、**結果** そのタグを持つすべての記事が時系列でリストされている
3. **前提** 記事が複数のタグを持つ、**条件** 記事を表示する、**結果** すべてのタグが表示されクリック可能である

---

### エッジケース

- Markdownファイルに無効なフロントマターがある場合はどうなるか？ ビルドは、どのファイルに問題があるかを示す明確なエラーメッセージで失敗すべきです。
- システムは同じ日付の記事をどのように処理するか？ 記事は日付でソートし、次にタイトルをアルファベット順でタイブレーカーとして使用すべきです。
- 記事のフロントマターにタイトルがない場合はどうなるか？ ビルドは、タイトルが必須フィールドであることを示す明確なエラーメッセージで失敗すべきです。
- 記事のフロントマターにスラグがない場合はどうなるか？ システムは一意のランダムな英数字スラグ（8-12文字）を自動生成すべきです。
- 2つの記事が同じスラグを持つ場合はどうなるか？ ビルドは、スラグの衝突とどのファイルが競合しているかを示す明確なエラーメッセージで失敗すべきです。
- 日本語および混在言語のファイル名はどのように処理されるか？ ファイル名は日本語、英語、または混在文字を含むことができます。ファイル名はURLスラグに影響しません。
- 記事の画像リンクが壊れている場合はどうなるか？ サイトはビルドされますが、ページ全体を壊すのではなく、欠落画像のプレースホルダーを表示すべきです。
- 非常に長い記事はどのように処理されるか？ 長い記事は完全にレンダリングされるべきです。一定の長さを超える記事にはオプションの目次生成を追加することを検討してください。
- 記事のタグが0件の場合はどうなるか？ 記事は空のタグ配列で正常にビルドされるべきです。タグ関連のUIは空の配列を適切に処理すべきです。

## 要件 _(必須)_

### 機能要件

- **FR-001**: システムはMarkdownファイルをセマンティックマークアップを持つHTMLページにレンダリングしなければならない
- **FR-002**: システムはYAMLフロントマターからメタデータを抽出しなければならない（最低限: title、date、オプション: description、tags、draft status）
- **FR-003**: システムは公開されたすべての記事を逆時系列順でリストするホームページを生成しなければならない
- **FR-004**: システムは予測可能なURL構造で各記事の個別ページを作成しなければならない（例: `/posts/[slug]` または `/[year]/[month]/[slug]`）
- **FR-005**: システムは標準Markdown構文をサポートしなければならない: 見出し（h1-h6）、段落、太字、斜体、リンク、順序付き/順序なしリスト、コードブロック、インラインコード、引用、画像
- **FR-006**: システムはドラフト記事（フロントマターフラグで識別）を公開ビルド出力から除外しなければならない
- **FR-007**: システムはユーザー設定トグル付きのライトとダークテーマを提供しなければならない
- **FR-008**: システムはブラウザセッション間でテーマ設定を永続化しなければならない
- **FR-009**: システムはインデックスと個別記事間のナビゲーションを提供しなければならない
- **FR-010**: システムはサーバーランタイムなしでホストできる静的HTMLファイルを生成しなければならない
- **FR-011**: システムは言語指定付きコードブロックのシンタックスハイライトをサポートしなければならない
- **FR-012**: システムは320pxからデスクトップ幅までの画面サイズでレスポンシブで読みやすくなければならない
- **FR-013**: システムはランダム文字列を使用して一意のURLスラグを生成しなければならない（ファイル名からは生成しない）。スラグはUUIDより短く、一般的に使用される文字（英数字）を使用し、日本語文字を含んではならない。フロントマターにスラグが指定されていない場合、システムは自動的にランダムスラグを生成する
- **FR-014**: システムは記事ファイルからの相対参照または中央アセットディレクトリからの画像をサポートしなければならない
- **FR-015**: システムはインデックスと記事ページの両方で記事メタデータ（title、date、オプションでdescription/tags）を表示しなければならない
- **FR-016**: システムはフロントマターで指定された場合、タグ/カテゴリーで記事を整理し、フィルタされたビューを自動的に生成しなければならない
- **FR-017**: システムはタグが0件の記事（空のタグ配列）を許可し、エラーなしで正常にビルドしなければならない
- **FR-018**: システムは日本語、英語、または日本語・英語混在のファイル名をサポートしなければならない

### 主要エンティティ

- **ブログ記事**: 単一の書かれたコンテンツを表します。主要属性: title（文字列、必須、日本語可能）、date（ISO日付、必須）、slug（英数字のランダム文字列、フロントマターに指定されていない場合は自動生成、一意でURL安全である必要があり、日本語文字は不可）、content（Markdownテキスト）、description（プレビュー用オプション文字列）、tags（オプション文字列配列、空配列可）、draft status（オプションboolean、デフォルトfalse）。ファイル名は日本語、英語、または混在可能。関係: 複数のタグに属する可能性があります（または0件のタグ）。

- **タグ/カテゴリー**: 記事をグループ化するトピックまたはテーマを表します。主要属性: name（文字列）、slug（URL安全な文字列）。関係: 多数のブログ記事を持ちます。

- **サイトメタデータ**: グローバルブログ設定を表します。主要属性: サイトタイトル、著者名、ベースURL、テーマ設定（light/dark/system）。これは記事ごとのフロントマターではなく設定ファイルに保存される可能性があります。

## 成功基準 _(必須)_

### 測定可能な成果

- **SC-001**: ライターは新しいブログ記事を作成し、5分以内にライブサイトに公開できる（Markdown執筆、ファイル保存、ビルド/デプロイトリガー）
- **SC-002**: 読者はホームページから2クリック以内で公開された任意の記事を発見して読むことができる
- **SC-003**: ブログ記事は320px幅から4Kディスプレイまでのデバイスで横スクロールなしで読める
- **SC-004**: サイトは3G接続で2秒以内に読みやすいコンテンツを読み込んで表示する
- **SC-005**: ライターはコンテンツやメタデータを失うことなく、Markdownファイルをコピーするだけで、すべてのコンテンツを別のプラットフォームに移行できる
- **SC-006**: サイトはJavaScriptを無効にして完全に機能する（静的HTMLとCSSのみ）、ただしテーマトグルにはJavaScriptが必要
- **SC-007**: すべてのブログ記事は色のコントラストとセマンティックHTMLについてWCAG AA アクセシビリティ基準を満たす
- **SC-008**: 2000語のコンテンツを持つ新しい記事を追加すると、ビルド時間が5秒未満増加する
- **SC-009**: ブログはホームページまたは個別記事ページでパフォーマンス低下なしに少なくとも100記事をサポートする
- **SC-010**: 標準Markdown構文の95%がカスタムフォーマットや回避策なしで正しくレンダリングされる

## 前提

1. **静的サイトジェネレータとしてのAstro**: プロジェクトはユーザー入力で明示的に述べられているように、静的サイト生成にAstroを使用します。これによりMarkdownファーストワークフローと静的出力要件が可能になります。

2. **Gitベースのバージョン管理**: コンテンツはGitを使用してバージョン管理され、ロールバック、履歴追跡、ドラフト用のブランチベースワークフローが可能になります。

3. **ファイルシステムベースのコンテンツストレージ**: ブログ記事はデータベースやCMSではなく、指定されたディレクトリ（例: `src/content/posts/`）に `.md` ファイルとして保存されます。

4. **ビルド時生成**: ブログ全体はリクエスト時ではなくビルド時に生成されます。これは静的ファースト要件とプラットフォーム独立性の目標と一致します。

5. **Markdownフロントマター形式**: フロントマターは各ファイルの先頭で `---` デリミタ間のYAML形式を使用します。これはほとんどの静的サイトジェネレータの標準です。

6. **バックエンドサーバー不要**: 生成されたサイトは静的HTML、CSS、最小限のJavaScriptのみで構成され、任意の静的ファイルホスト（Netlify、Vercel、GitHub Pagesなど）でホストできます。

7. **モダンブラウザサポート**: サイトは過去2年以内にリリースされたブラウザをターゲットとし、カスタムプロパティやグリッドなどのモダンCSS機能をサポートします。レガシーブラウザサポートは優先事項ではありません。

8. **シンタックスハイライトライブラリ**: 軽量シンタックスハイライトライブラリ（例: ShikiまたはPrism）がコードブロックに使用され、ランタイムJavaScriptを避けるためビルド時に統合されます。

9. **単一著者**: ブログは単一著者用に設計されています。複数著者サポート（著者帰属、フィルタリング）は明示的にスコープ外です。

10. **動的機能なし**: すべてのコンテンツは事前レンダリングされます。リアルタイムデータを必要とする機能（ビューカウント、ライブコメント、パーソナライゼーション）はMVPのスコープ外です。

11. **デフォルトソート**: 記事はホームページで日付降順（新しい順）でソートされます。代替ソート方法は必要ありません。

12. **URL構造**: 記事URLは `/posts/[slug]` のパターンに従います。slugはランダムな英数字文字列（UUIDより短い、例: 8-12文字）で、フロントマターで指定されるか自動生成されます。スラグはファイル名からは派生しません。これにより、タイトルやファイル名の変更に関係なく、一意性、利便性、長期的なパーマリンクの永続性が保証されます。

13. **テーマトグルUI**: 一貫した場所（ヘッダーまたはフッター）のシンプルなトグルボタンまたはアイコンにより、ライトとダークモード間の切り替えが可能です。テーマ設定はlocalStorageに保存されます。

14. **レスポンシブブレークポイント**: 標準ブレークポイントが使用されます（例: モバイル <768px、タブレット 768-1024px、デスクトップ >1024px）レスポンシブデザイン用。

15. **外部API依存関係なし**: ブログは中核機能のために外部サービスに依存しません。アナリティクスまたはオプションの埋め込み（YouTubeなど）は外部スクリプトを使用する可能性がありますが、ブログが機能するために必要ではありません。

## スコープ外

以下はこの仕様から明示的に除外されます:

- 記事を作成または編集するための管理ダッシュボードまたはコンテンツ管理UI
- 認証、ユーザーアカウント、ロール、または権限
- コメント、いいね、リアクション、またはその他のインタラクティブなソーシャル機能
- サイト全体の検索、フィルタリング、またはレコメンデーションシステム
- アナリティクス駆動のランキング、パーソナライゼーション、または人気ベースの順序付け
- 多言語または国際化サポート
- 外部CMS、データベース、またはサードパーティコンテンツサービスへの依存
- RSSフィード生成（後で追加される可能性がありますが、MVPには必須ではありません）
- 関連記事またはコンテンツレコメンデーション
- ソーシャルメディア共有ボタンまたはオープングラフメタタグ（後で追加可能）
- ニュースレター統合またはメールキャプチャ
- コンタクトフォームまたは著者コミュニケーション機能
- 画像最適化またはレスポンシブ画像生成（画像はコンテンツに追加する前に最適化されていると仮定）
- カスタムショートコードまたは高度なMDXコンポーネント（MVPには標準Markdownのみ）
