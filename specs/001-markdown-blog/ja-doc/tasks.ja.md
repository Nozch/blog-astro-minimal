# タスク: ミニマルMarkdownブログ

**入力**: `/specs/001-markdown-blog/` からの設計ドキュメント
**前提条件**: plan.md、spec.md、research.md、data-model.md、contracts/frontmatter-schema.yaml、quickstart.md

**テストポリシー**: 機能固有のテストは含まれていません（仕様で明示的に要求されていません）。ただし、技術要件に従って、CI自動化と品質ゲート（型チェック、リント、ビルド検証）が設定されています。

**構成**: タスクはユーザーストーリーごとにグループ化されており、段階的で追加的な提供を可能にします。各ストーリーは既存の機能を壊すことなく前の作業に基づいて構築されます。

## フォーマット: `[ID] [Story] 説明`

- **[Story]**: このタスクが属するユーザーストーリー（例: US1、US2、US3、US4）
- 説明には正確なファイルパスを含める

## パス規約

- 単一のAstroプロジェクト: リポジトリルートに `src/`、`tests/`、`public/`
- コンテンツコレクション: Markdownブログ記事用に `src/content/posts/`
- ビルド出力: `dist/`（Astroによって生成）

---

## フェーズ1: セットアップ（共有インフラストラクチャ）

**目的**: プロジェクトの初期化と基本構造

- [ ] T001 リポジトリルートで npm create astro@latest を使用してAstroプロジェクトを初期化
- [ ] T002 依存関係のインストール: astro@latest、typescript
- [ ] T003 tsconfig.json で TypeScript を設定（strict モード有効）
- [ ] T004 Astro プラグインを使用して .eslintrc.json で ESLint を設定
- [ ] T005 node_modules/、dist/、.astro/、.env ファイル用の .gitignore を作成
- [ ] T006 astro.config.mjs で Astro を設定（サイトURL、Shiki シンタックスハイライトを使用した基本的な Markdown レンダリング）
- [ ] T007 ディレクトリ構造を作成: src/content/posts/、src/layouts/、src/components/、src/styles/、src/pages/posts/、src/pages/tags/

---

## フェーズ2: 基盤（ブロッキング前提条件）

**目的**: 記事をレンダリングして公開するために必要な最小限のコアインフラストラクチャ（ユーザーストーリー1）

**⚠️ 重要**: このフェーズはすべてのユーザーストーリー作業をブロックします - Markdown記事をレンダリングするための基盤を提供します

- [ ] T008 src/content/config.ts で Zod を使用してコンテンツコレクションスキーマを定義（title: string 必須、date: date 必須、slug: string 公開記事には必須、description: string オプション、tags: string[] デフォルト []、draft: boolean デフォルト false）。注意: ドラフト（draft: true）はスラグを省略できますが、すべての公開記事はフロントマターに明示的なスラグが必要です。
- [ ] T009 src/layouts/BaseLayout.astro に BaseLayout コンポーネントを作成（HTML構造、メタタグ付きhead、ビューポート、CSSリンク）
- [ ] T010 src/styles/global.css に最小限のグローバルスタイルを作成（box-sizing とマージンのデフォルトを含む基本的な CSS リセット、body のシステムフォントスタック、テキスト/背景/リンク用のシンプルなハードコードされたライトモードカラー、h1-h6/p/code/pre/ul/ol/blockquote の基本的なセマンティック HTML 要素スタイリング）
- [ ] T011 ビルド検証テスト用に vitest.config.ts で Vitest を設定
- [ ] T012 .github/workflows/ci.yml で GitHub Actions CI を設定（型チェック、リント、テスト、ビルドステップ）

**チェックポイント**: 最小限の基盤準備完了 - ユーザーストーリー1を実装できるようになりました

---

## フェーズ3: ユーザーストーリー1 - ブログ記事の執筆と公開（優先度: P1）🎯 MVP

**目標**: ライターがフロントマター付きの Markdown ブログ記事を作成し、コンテンツディレクトリに配置し、サイトをビルドして、正しいレンダリングでブログに記事が表示されるようにする

**独立テスト**: フロントマター（title、date、**明示的なスラグ**、オプションで description）、標準的な Markdown 要素（見出し、段落、太字、斜体、リンク、リスト、コードブロック、引用）を含む Markdown ファイルを作成し、src/content/posts/ に配置し、astro build を実行し、ホームページに表示され、/posts/[slug] で正しくレンダリングされることを確認

### ユーザーストーリー1の実装

- [ ] T013 [US1] src/content/posts/example-post.md にすべての必須フロントマターフィールド（title、date、slug: "a8k3n9x2"、description、tags、draft: false）と標準的な Markdown 要素を含むサンプルブログ記事を作成
- [ ] T014 [US1] draft: true フラグを持つドラフトサンプル記事を src/content/posts/draft-example.md に作成（ドラフトの場合、スラグはオプション）
- [ ] T015 [US1] src/pages/index.astro にホームページを作成（getCollection で公開記事をクエリ、日付降順でソート、記事リストをレンダリング）
- [ ] T016 [US1] src/components/PostList.astro に PostList コンポーネントを作成（title、date、description、記事へのリンクを表示）
- [ ] T017 [US1] src/pages/posts/[slug].astro に個別記事ページを作成（すべての公開記事の getStaticPaths、Markdown で記事コンテンツをレンダリング、メタデータを表示）
- [ ] T018 [US1] src/components/PostMeta.astro に PostMeta コンポーネントを作成（title、date、tags を表示）
- [ ] T019 [US1] src/content/config.ts にスラグ一意性検証を追加（提供されたスラグが一意で英数字8-12文字であることを検証、重複または公開記事のスラグ欠落時に明確なエラーでビルドを失敗させる）
- [ ] T020 [US1] ドラフト記事の除外を確認: サイトをビルドし、dist/ 出力にドラフト記事が表示されないことを確認
- [ ] T021 [US1] Markdown レンダリングを確認: すべての標準要素（見出し、段落、太字、斜体、リンク、リスト、シンタックスハイライト付きコードブロック、引用）がセマンティック HTML でレンダリングされることを確認
- [ ] T022 [US1] src/components/Header.astro にサイトタイトルのみの Header コンポーネントを作成（オプションの仕上げ - まだナビゲーションなし）

**チェックポイント**: ユーザーストーリー1が完了しテスト可能。ライターは明示的なスラグで Markdown 記事を公開し、正しくレンダリングされるのを確認できます。MVP として出荷準備完了。

---

## フェーズ4: ユーザーストーリー2 - ブログ記事の閲覧とナビゲート（優先度: P2）

**目標**: 読者がホームページで時系列の記事リストを表示し、明確なタイトル/日付で個別記事にナビゲートし、ホームページに戻ることができるようにする

**段階的テスト**: US1に基づいて、異なる日付で複数の記事を公開し、ホームページにアクセスし、記事が逆時系列順（新しい順）にリストされていることを確認し、記事タイトルをクリックして完全な記事にナビゲートし、ホームへの戻りリンクが機能することを確認

### ユーザーストーリー2の実装

- [ ] T023 [US2] index.astro のホームページを逆時系列ソートで強化（US1で既に実装済み、日付、次にタイトルでのソートを確認）
- [ ] T024 [US2] 個別記事ページ src/pages/posts/[slug].astro にホームページへ戻るナビゲーションリンクを追加
- [ ] T025 [US2] PostList コンポーネントを強化して、フロントマターで利用可能な場合は記事の description をプレビュースニペットとして表示
- [ ] T026 [US2] ナビゲーションを確認: 異なる日付で3つ以上のテスト記事を作成し、サイトをビルドし、ホームページが正しい順序で記事をリストすることを確認し、記事リンクが機能し、ホームへの戻りリンクが機能することを確認
- [ ] T027 [US2] src/components/Header.astro の Header コンポーネントをナビゲーションリンクで強化（ホームリンク、クリック可能なサイトタイトルを確保）

**チェックポイント**: ユーザーストーリー1と2が完了。ブログには基本的な公開とナビゲーション機能があります。各ストーリーは前の機能を壊すことなく価値を追加します。

---

## フェーズ5: ユーザーストーリー3 - 気が散らない環境での記事閲覧（優先度: P3）

**目標**: 最適化されたタイポグラフィ、適切な行長、ライト/ダークモードサポート、すべての画面サイズに対応するレスポンシブデザインを備えた、クリーンで読みやすいレイアウトを提供

**段階的テスト**: US1とUS2に基づいて、デスクトップとモバイルで記事を開き、タイポグラフィ（フォントサイズ18-20px、行の高さ1.6-1.8、行長50-75文字）を確認し、ダークモードを切り替えてセッション間でテーマが持続することを確認し、320pxから4K画面までのレスポンシブレイアウトを確認

### ユーザーストーリー3の実装

- [ ] T028 [US3] global.css に完全なタイポグラフィシステムを追加（コンテンツの最適な行長 max-width: 65ch、clamp を使用したフォントサイズ18-20px、行の高さ1.7、快適なマージン、適切な垂直リズム）
- [ ] T029 [US3] global.css にライト/ダークテーマ用の CSS カスタムプロパティを追加（--color-text、--color-bg、--color-accent 変数を定義、ダーク値で [data-theme="dark"] セレクタを追加、WCAG AA コントラスト比を確保、ハードコードされた色を CSS 変数に置き換え）
- [ ] T030 [US3] global.css にレスポンシブブレークポイントを追加（モバイル <768px、タブレット 768-1024px、デスクトップ >1024px のメディアクエリ、ブレークポイントごとにフォントサイズとマージンを調整、横スクロールなしを確保）
- [ ] T031 [US3] astro.config.mjs で Shiki デュアルテーマシンタックスハイライトを設定（基本設定からデュアルテーマに更新: ライトモード用 github-light、ダークモード用 github-dark、長い行用 wrap: true）
- [ ] T032 [US3] src/components/ThemeToggle.astro に ThemeToggle コンポーネントを作成（localStorage 永続化付きライト/ダークモード切り替えボタン、保存された値がない場合は prefers-color-scheme でシステム設定を尊重、Header または BaseLayout に切り替えを追加）
- [ ] T033 [US3] タイポグラフィを確認: デスクトップで記事を開き、行長、フォントサイズ、行の高さが仕様を満たすことを確認（50-75文字、18-20px、1.6-1.8）
- [ ] T034 [US3] ダークモードを確認: テーマを切り替え、localStorage の永続化を確認し、ページをリロードしてテーマが持続することを確認し、コントラスト比が WCAG AA に合格することを確認
- [ ] T035 [US3] レスポンシブデザインを確認: 320px モバイル、タブレット、デスクトップ、4K ディスプレイでテストし、横スクロールなし、ズームなしで読みやすいテキストを確認

**チェックポイント**: 読書体験が完了。ブログには最適化されたタイポグラフィ、ダークモード、レスポンシブデザインがあります。すべての改善は前のストーリーに追加的です。

---

## フェーズ6: ユーザーストーリー4 - トピック別の記事整理（優先度: P4）

**目標**: ライターがフロントマターでタグを使用して記事を分類し、タグページを自動生成し、読者がタグで記事をフィルタリングできるようにする

**段階的テスト**: 前のストーリーに基づいて、記事のフロントマターにタグを追加し、サイトをビルドし、記事がリンク付きのタグを表示することを確認し、タグリンクをクリックしてタグページに移動し、タグページがそのタグを持つすべての記事を時系列でリストすることを確認

### ユーザーストーリー4の実装

- [ ] T036 [US4] src/pages/tags/[tag].astro にタグページを作成（一意のタグを抽出する getStaticPaths、タグで記事をフィルタリング、フィルタリングされた記事リストをレンダリング）
- [ ] T037 [US4] PostMeta コンポーネントを強化してクリック可能なタグリンクを表示（各タグが /tags/[tag] にリンク）
- [ ] T038 [US4] ホームページ src/pages/index.astro にタグリストを追加（オプション: 記事数付きの利用可能なすべてのタグを表示）
- [ ] T039 [US4] タグ機能を確認: タグ付き記事を作成（タグが0件の記事、複数のタグを持つ記事を含む）、サイトをビルドし、タグページが生成され、タグリンクが機能し、フィルタリングされたリストが正しいことを確認

**チェックポイント**: すべてのユーザーストーリーが完了。ブログは仕様からの完全な機能セットをサポートします。各ストーリーは前の作業を壊すことなく段階的に価値を追加しました。

---

## フェーズ7: 仕上げとクロスカッティング懸念事項

**目的**: 複数のユーザーストーリーに影響する改善、最終検証、デプロイメント準備

- [ ] T040 BaseLayout.astro に SEO 用メタタグを追加（og:title、og:description、twitter:card）
- [ ] T041 public/ ディレクトリに favicon とサイトメタデータを追加
- [ ] T042 src/components/Footer.astro に Footer コンポーネントを作成（著作権、最小限のフッターコンテンツ - オプション、非MVP）
- [ ] T043 ビルドパフォーマンスを確認: 10件以上の記事を追加し、astro build を実行し、記事ごとのビルド時間増加が <5秒であることを確認（SC-008）
- [ ] T044 アクセシビリティを確認: Lighthouse 監査を実行し、WCAG AA コントラスト比、セマンティック HTML、スコア ≥90 を確認（SC-007、FR-012）
- [ ] T045 プラットフォーム独立性を確認: Markdown ファイルを別の場所にコピーし、メタデータを保持したままコンテンツが移植可能であることを確認（SC-005）
- [ ] T046 quickstart.md に従って完全な検証を実行: すべての手動テストシナリオを実行し、spec.md からのすべての受け入れ基準を確認
- [ ] T047 セットアップ手順、デプロイメントガイド、コンテンツ作成ガイドラインを含む README.md を作成
- [ ] T048 global.css を最適化: 未使用のスタイルを削除し、最小限の CSS バンドルサイズを確保
- [ ] T049 最終デプロイメントテスト: 静的ホスト（Netlify、Vercel、または GitHub Pages）にデプロイし、3G でサイトが <2秒でロードすることを確認（SC-004）

---

## 依存関係と実行順序

### フェーズ依存関係

- **セットアップ（フェーズ1）**: 依存関係なし - すぐに開始可能
- **基盤（フェーズ2）**: セットアップ完了に依存 - すべてのユーザーストーリー作業をブロック
- **ユーザーストーリー（フェーズ3-6）**: すべて基盤フェーズ完了に依存
  - フェーズ2の後、ユーザーストーリーは優先順位（P1 → P2 → P3 → P4）で段階的に実装
  - 各ストーリーは既存の機能を壊すことなく前の作業に基づいて構築
- **仕上げ（フェーズ7）**: すべての希望するユーザーストーリーが完了していることに依存

### ユーザーストーリーフロー（段階的提供）

- **ユーザーストーリー1（P1）**: 基盤の後に開始 - コア公開機能 - **MVP ターゲット**
- **ユーザーストーリー2（P2）**: US1に基づいて構築 - ナビゲーションを追加 - 段階的にテスト可能
- **ユーザーストーリー3（P3）**: US1+US2に基づいて構築 - 読書体験の仕上げを追加 - 段階的にテスト可能
- **ユーザーストーリー4（P4）**: US1+US2+US3に基づいて構築 - タグ整理を追加 - 段階的にテスト可能

### 各ユーザーストーリー内

- コンテンツコレクションスキーマ（T008）は記事関連のすべてのタスクの前に完了する必要があります
- BaseLayout と最小限の global.css はページ実装の前に準備が必要です
- サービス/ページの前にモデル/ユーティリティ
- 検証タスクの前にコア実装
- 次の優先度に移る前にストーリーを完了

---

## 実装戦略

### MVP ファースト（ユーザーストーリー1のみ）

1. フェーズ1を完了: セットアップ
2. フェーズ2を完了: 基盤（重要 - 記事をレンダリングするためのコアインフラストラクチャを提供）
3. フェーズ3を完了: ユーザーストーリー1
4. **停止して検証**: ユーザーストーリー1を独立してテスト（明示的なスラグで記事を作成し、ビルドし、レンダリングを確認）
5. 準備ができていればデプロイ/デモ

### 段階的提供

1. セットアップ + 基盤を完了 → 最小限の基盤準備完了
2. ユーザーストーリー1を追加 → 段階的にテスト → デプロイ/デモ（MVP! ライターは明示的なスラグで記事を公開可能）
3. ユーザーストーリー2を追加 → 段階的にテスト → デプロイ/デモ（読者は記事をナビゲート可能）
4. ユーザーストーリー3を追加 → 段階的にテスト → デプロイ/デモ（タイポグラフィ、ダークモード、レスポンシブで読書体験を最適化）
5. ユーザーストーリー4を追加 → 段階的にテスト → デプロイ/デモ（タグ整理が完了）
6. 各ストーリーは前のストーリーを壊すことなく段階的に価値を追加

---

## 注意事項

- [Story] ラベルはタスクを特定のユーザーストーリーにマッピングしてトレーサビリティを確保
- 各ユーザーストーリーは段階的に提供可能でテスト可能
- 機能固有のテストは含まれていません（仕様で必須ではありません）が、CI/ビルド検証は設定されています
- 各タスクまたは論理グループの後にコミット
- 任意のチェックポイントで停止してストーリーを段階的に検証
- 避けるべきこと: 曖昧なタスク、同じファイルの競合、段階的提供を妨げるストーリー間の依存関係
- **MVP スラグポリシー**: すべての公開記事のフロントマターに明示的なスラグが必須。URL の永続性を保証するため、ビルド時のスラグ生成は意図的に禁止されています。ライターは記事作成時に英数字のスラグ（8-12文字、日本語文字なし）を提供する必要があります。
- タグ0件が許可されます（FR-017） - タグ関連の UI が空の配列を処理することを確認
- 日本語/英語/混在ファイル名がサポートされています（FR-018） - スラグは英数字のまま

---

## 過剰エンジニアリングレビューからの主な変更

**フェーズ2（基盤） - 8から5タスクに削減**:
- ✅ T010: **最小限の CSS のみ**に改訂（基本的なリセット、読みやすいデフォルト、タイポグラフィシステム/テーマ変数/レスポンシブなし）
- ❌ T011 ThemeToggle: **削除**（ダークモードが指定されている US3 に移動）
- ❌ T012 Header: **削除**（サイトタイトルは US1 のオプションに移動、ナビゲーションは US2 に移動）
- ❌ T013 Footer: **削除**（非MVP としてフェーズ7の仕上げに移動）

**ユーザーストーリー1 - 1タスク追加**:
- ✅ T023（現在 T022）: サイトタイトル付きヘッダー（US1 内のオプションの仕上げ）

**ユーザーストーリー2 - 1タスク追加**:
- ✅ T028（現在 T027）: ヘッダーナビゲーションリンク（US2 の受け入れ基準に必須）

**ユーザーストーリー3 - タスクを統合**:
- ✅ T029-T031（現在 T028-T030）: 完全なタイポグラフィシステム、CSS カスタムプロパティ、レスポンシブブレークポイント（旧 T010 からのコンテンツ）
- ✅ T033（現在 T032）: ThemeToggle 作成 + システム設定（旧 T011 + T034 を統合）

**フェーズ7（仕上げ） - 1タスク追加**:
- ✅ T043（現在 T042）: Footer コンポーネント（オプション、非MVP）

**並列計画を削除**:
- ❌ すべての [P] マーカーを削除（ソロ開発者 MVP には実行不可能）
- ❌ 「並列の機会」セクションを削除
- ❌ 「並列の例」セクションを削除
- ❌ 「並列チーム戦略」セクションを削除

**言い回しの修正**:
- ✅ テストポリシーを明確化（CI/品質ゲート vs 機能テスト）
- ✅ Shiki デュアルテーマを統合（T006 で基本、T031 でデュアルテーマ）
- ✅ 全体を通じて「独立」を「段階的/追加的」に変更
- ✅ フェーズ2のブロッキング言語を明確化（US1 の垂直スライスをブロック）

**MVP スラグポリシーの適用**:
- ✅ T008: スキーマで公開記事にスラグが必須に
- ❌ T019: スラグ自動生成ユーティリティを MVP から削除（明示的なスラグのみ）
- ✅ T013/T014: サンプル記事を更新して明示的なスラグ要件を表示
- ✅ T019（T020 から番号変更）: 提供されたスラグのみを検証するようにスラグ検証を更新
- ✅ 注意事項セクション: 明示的な MVP スラグポリシーを文書化

**結果**: MVP（フェーズ1 + フェーズ2 + US1）は現在49タスク（以前は50）、URL の永続性のために明示的なスラグを適用し、US3 の仕上げ機能からブロック解除され、最小限の基盤でより速く出荷でき、ソロ開発者のための明確な順次実行パスと正確な段階的提供モデルを持っています。
